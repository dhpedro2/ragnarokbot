<!DOCTYPE html>
<html>
<head>
    <title>Site</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <style>
        table {
            border-collapse: collapse;
            width: 100%;
        }

        th, td {
            text-align: left;
            padding: 8px;
            border-bottom: 1px solid #ddd;
        }
    </style>
</head>
<body>
    <h1>Bagulho de level</h1>
    <form id="formNome">
        <label for="nome">Nome:</label>
        <select id="nome" name="nome">
            <option value="Beelzebulb">Beelzebulb</option>
            <option value="Orpheu">Orpheu</option>
            <option value="Arthur Maquiavel">Arthur Maquiavel</option>
            <option value="Alexandre">Alexandre</option>
            <option value="Luis Alberto">Luis Alberto</option>
            <option value="Akio Sato">Akio Sato</option>
            <option value="Lohanna Armani">Lohanna Armani</option>
        </select>
        <br>
        <label for="numero">Level:</label>
        <input type="text" id="numero" name="numero">
        <input type="hidden" id="id" name="id"> <!-- Adicionado campo oculto para armazenar o ID -->
        <br>
        <input type="submit" value="Enviar">
    </form>

    <h2>Dados Salvos:</h2>
    <table id="dadosTable">
        <thead>
            <tr>
                <th>Nome</th>
                <th>Level</th>
                <th>ID</th>
                <th>Ações</th> <!-- Adicionado cabeçalho para as ações de edição e exclusão -->
            </tr>
        </thead>
        <tbody id="dadosList"></tbody>
    </table>

    <script>
        // Configurações do Firebase
        var firebaseConfig = {
            apiKey: 'YOUR_API_KEY',
            authDomain: 'YOUR_AUTH_DOMAIN',
            projectId: 'YOUR_PROJECT_ID',
            databaseURL: 'YOUR_DATABASE_URL',
            storageBucket: 'YOUR_STORAGE_BUCKET',
            messagingSenderId: 'YOUR_MESSAGING_SENDER_ID',
            appId: 'YOUR_APP_ID'
        };

        // Inicializa o app do Firebase
        firebase.initializeApp(firebaseConfig);

        // Obtém uma referência para o Realtime Database do Firebase
        var database = firebase.database();

        // Evento de envio do formulário
        document.getElementById('formNome').addEventListener('submit', function(event) {
            event.preventDefault(); // Impede o envio do formulário padrão

            var nome = document.getElementById('nome').value;
            var numero = document.getElementById('numero').value;
            var id = document.getElementById('id').value;

            // Verifica se o nome já existe no banco de dados
            database.ref('nomes').orderByChild('nome').equalTo(nome).once('value', function(snapshot) {
                if (snapshot.exists()) {
                    // Atualiza o número associado ao nome existente
                    snapshot.forEach(function(childSnapshot) {
                        var key = childSnapshot.key;
                        database.ref('nomes/' + key).update({ numero: numero });
                    });
                } else {
                    // Salva um novo registro no banco de dados
                    database.ref('nomes').push({ nome: nome, numero: numero });
                }
            });

            // Limpa os campos do formulário após o envio
            document.getElementById('numero').value = '';
            document.getElementById('id').value = '';
        });

        // Monitora as alterações no Realtime Database e atualiza a tabela
        database.ref('nomes').on('value', function(snapshot) {
            var dadosList = document.getElementById('dadosList');
            dadosList.innerHTML = '';

            snapshot.forEach(function(childSnapshot) {
                var nome = childSnapshot.val().nome;
                var numero = childSnapshot.val().numero;
                var id = childSnapshot.key;

                var row = dadosList.insertRow();
                var cell1 = row.insertCell(0);
                var cell2 = row.insertCell(1);
                var cell3 = row.insertCell(2);
                var cell4 = row.insertCell(3);

                cell1.innerHTML = nome;
                cell2.innerHTML = numero;
                cell3.innerHTML = id;
                cell4.innerHTML = '<button onclick="editRecord(\'' + id + '\', \'' + nome + '\', \'' + numero + '\')">Editar</button>'; // Botão de edição

                // Função para preencher o formulário com os dados do registro selecionado
                function editRecord(recordId, recordNome, recordNumero) {
                    document.getElementById('id').value = recordId;
                    document.getElementById('nome').value = recordNome;
                    document.getElementById('numero').value = recordNumero;
                }
            });
        });
    </script>
</body>
</html>
